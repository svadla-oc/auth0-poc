{"version":3,"sources":["meteor://ðŸ’»app/packages/cottz:publish-relations/lib/server/index.js","meteor://ðŸ’»app/packages/cottz:publish-relations/lib/server/handler_controller.js","meteor://ðŸ’»app/packages/cottz:publish-relations/lib/server/methods.js","meteor://ðŸ’»app/packages/cottz:publish-relations/lib/server/publish_relations.js","meteor://ðŸ’»app/packages/cottz:publish-relations/lib/server/cursor/change_parent_doc.js","meteor://ðŸ’»app/packages/cottz:publish-relations/lib/server/cursor/crossbar.js","meteor://ðŸ’»app/packages/cottz:publish-relations/lib/server/cursor/cursor.js","meteor://ðŸ’»app/packages/cottz:publish-relations/lib/server/cursor/index.js","meteor://ðŸ’»app/packages/cottz:publish-relations/lib/server/cursor/join.js","meteor://ðŸ’»app/packages/cottz:publish-relations/lib/server/cursor/observe.js","meteor://ðŸ’»app/packages/cottz:publish-relations/lib/server/cursor/utils.js","meteor://ðŸ’»app/packages/cottz:publish-relations/lib/server/cursor/nonreactive/cursor.js","meteor://ðŸ’»app/packages/cottz:publish-relations/lib/server/cursor/nonreactive/index.js","meteor://ðŸ’»app/packages/cottz:publish-relations/lib/server/cursor/nonreactive/join.js"],"names":[],"mappings":"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","file":"/packages/cottz_publish-relations.js","sourcesContent":["import PublishRelations from './publish_relations';\nimport './methods';\n\nexport default PublishRelations;","import { _ } from 'meteor/underscore';\n// The aim of handler Controller is to keep all observers that can be created within methods\n// its structure is very simple, has a 'handlers' object containing all observers children and\n// the observer father is stored within 'handler'\nexport default class HandlerController {\n  constructor () {\n    this.handlers = {};\n  }\n  set (handler) {\n    return this.handler = handler;\n  }\n  addBasic (collection, handler) {\n    const oldHandler = this.handlers[collection];\n    return oldHandler || (this.handlers[collection] = handler || new HandlerController());\n  }\n  add (cursor, options) {\n    if (!cursor)\n      throw new Error(\"you're not sending the cursor\");\n\n    const description = cursor._cursorDescription;\n    const collection = options.collection || description.collectionName;\n    const selector = description.selector;\n\n    let oldHandler = this.handlers[collection];\n    if (oldHandler) {\n      // when the selector equals method stops running, no change occurs and everything\n      // will still work properly without running the same observer again\n      oldHandler.equalSelector = _.isEqual(oldHandler.selector, selector);\n      if (oldHandler.equalSelector)\n        return oldHandler;\n\n      oldHandler.stop();\n    }\n\n    const newHandler = options.handler\n    ? cursor[options.handler](options.callbacks)\n    : new HandlerController();\n\n    newHandler.selector = selector;\n\n    return this.handlers[collection] = newHandler;\n  }\n  stop () {\n    let handlers = this.handlers;\n\n    this.handler && this.handler.stop();\n\n    for (let key in handlers) {\n      handlers[key].stop();\n    };\n\n    this.handlers = [];\n  }\n  remove (_id) {\n    let handler = this.handlers[_id];\n    if (handler) {\n      handler.stop();\n      delete this.handlers[_id];\n    }\n  }\n}","import { Meteor } from 'meteor/meteor';\nimport { check, Match } from 'meteor/check';\nimport { DDPServer } from 'meteor/ddp-server';\n\nconst crossbar = DDPServer._InvalidationCrossbar;\n\nMeteor.methods({\n  'PR.changePagination' (data) {\n    check(data, {\n      _id: String,\n      field: String,\n      skip: Match.Integer\n    });\n\n    crossbar.fire(_.extend({\n      collection: 'paginations',\n      id: this.connection.id\n    }, data));\n  },\n  'PR.fireListener' (collection, options) {\n    check(collection, String);\n    check(options, Object);\n\n    crossbar.fire(_.extend({\n      collection: 'listen-' + collection,\n      id: this.connection.id,\n    }, options));\n  }\n});","import { Meteor } from 'meteor/meteor';\nimport HandlerController from './handler_controller';\nimport CursorMethods from './cursor';\n\nPublishRelations = function (name, callback) {\n  return Meteor.publish(name, function (...params) {\n    let handler = new HandlerController(),\n    cursors = new CursorMethods(this, handler);\n\n    this._publicationName = name;\n    this.onStop(() => handler.stop());\n\n    let cb = callback.apply(_.extend(cursors, this), params);\n    // kadira show me alerts when I use this return (but works well)\n    // return cb || (!this._ready && this.ready());\n    return cb;\n  });\n};\n\nMeteor.publishRelations = PublishRelations;\n\nexport default PublishRelations;\nexport { PublishRelations };","import CursorMethods from './cursor';\n// DEPRECATED\n// designed to change something in the master document while the callbacks are executed\n// changes to the document are sent to the main document with the return of the callbacks\nCursorMethods.prototype.changeParentDoc = function (cursor, callbacks, onRemoved) {\n  const sub = this.sub;\n  const _id = this._id;\n  const collection = this.collection;\n\n  let result = this;\n\n  if (!_id || !collection)\n    throw new Error(\"you can't use this method without being within a document\");\n\n  callbacks = this._getCallbacks(callbacks, onRemoved);\n\n  this.handler.add(cursor, {\n    handler: 'observeChanges',\n    callbacks: {\n      added (id, doc) {\n        result._addedWithCPD = callbacks.added(id, doc);\n      },\n      changed (id, doc) {\n        var changes = callbacks.changed(id, doc);\n        if (changes)\n          sub.changed(collection, _id, changes);\n      },\n      removed (id) {\n        var changes = callbacks.removed(id);\n        if (changes)\n          sub.changed(collection, _id, changes);\n      }\n    }\n  });\n\n  return result._addedWithCPD || {};\n};","import { _ } from 'meteor/underscore';\nimport CursorMethods from './cursor';\nimport { DDPServer } from 'meteor/ddp-server';\n\nconst crossbar = DDPServer._InvalidationCrossbar;\n// designed to paginate a list, works in conjunction with the methods\n// do not call back to the main callback, only the array is changed in the collection\nCursorMethods.prototype.paginate = function (fieldData, limit, infinite) {\n  const sub = this.sub;\n  const collection = this.collection;\n\n  if (!this._id || !collection)\n    throw new Error(\"you can't use this method without being within a document\");\n\n  const field = Object.keys(fieldData)[0];\n  const copy = _.clone(fieldData)[field];\n  const max = copy.length;\n  const connectionId = sub.connection.id;\n\n  fieldData[field] = copy.slice(0, limit);\n\n  const listener = crossbar.listen({\n    collection: 'paginations',\n    id: connectionId,\n  }, (data) => {\n    if (!data.id || data.id !== connectionId) return;\n\n    let skip = data.skip;\n\n    if (skip >= max && !infinite)\n      return;\n\n    fieldData[field] = infinite ? copy.slice(0, skip): copy.slice(skip, skip + limit);\n    sub.changed(collection, data._id, fieldData);\n  });\n\n  this.handler.addBasic(field, listener);\n\n  return fieldData[field];\n};\n\nCursorMethods.prototype.listen = function (options, callback, run) {\n  const sub = this.sub;\n  const name = 'listen-' + this._publicationName;\n\n  const listener = crossbar.listen({\n    collection: name,\n    id: sub.connection.id\n  }, (data) => {\n    if (!data.id || data.id !== sub.connection.id) return;\n\n    _.extend(options, _.omit(data, 'collection', 'id'));\n    callback(false);\n  });\n\n  const handler = this.handler.addBasic(name);\n\n  if (run !== false) callback(true);\n\n  return handler.set(listener);\n};","import { _ } from 'meteor/underscore';\nimport CursorMethodsNR from './nonreactive';\n\nexport default class CursorMethods extends CursorMethodsNR {\n  constructor (sub, handler, _id, collection) {\n    super(sub);\n\n    this.handler = handler;\n    this._id = _id;\n    this.collection = collection;\n  }\n  cursor (cursor, collection, callbacks) {\n    const sub = this.sub;\n\n    if (!_.isString(collection)) {\n      callbacks = collection;\n      collection = cursor._getCollectionName();\n    }\n\n    const handler = this.handler.add(cursor, {collection: collection});\n    if (handler.equalSelector)\n      return handler;\n\n    if (callbacks)\n      callbacks = this._getCallbacks(callbacks);\n\n    function applyCallback (id, doc, method) {\n      const cb = callbacks && callbacks[method];\n\n      if (cb) {\n        let methods = new CursorMethods(sub, handler.addBasic(id), id, collection),\n        isChanged = method === 'changed';\n\n        return cb.call(methods, id, doc, isChanged) || doc;\n      } else\n        return doc;\n    };\n\n    let observeChanges = cursor.observeChanges({\n      added (id, doc) {\n        sub.added(collection, id, applyCallback(id, doc, 'added'));\n      },\n      changed (id, doc) {\n        sub.changed(collection, id, applyCallback(id, doc, 'changed'));\n      },\n      removed (id) {\n        if (callbacks) {\n          callbacks.removed(id);\n          handler.remove(id);\n        }\n\n        sub.removed(collection, id);\n      }\n    });\n\n    return handler.set(observeChanges);\n  }\n};","import CursorMethods from './cursor';\nimport './join';\nimport './observe';\nimport './change_parent_doc';\nimport './crossbar';\nimport './utils';\n\nexport default CursorMethods;","import { _ } from 'meteor/underscore';\nimport CursorMethods from './cursor';\n\nCursorMethods.prototype.join = function (...params) {\n  return new CursorJoin(this, ...params);\n};\n\nclass CursorJoin {\n  constructor (methods, collection, options, name) {\n    this.methods = methods;\n    this.collection = collection;\n    this.options = options;\n    this.name = name;\n\n    this.data = [];\n    this.sent = false;\n  }\n  push (..._ids) {\n    let changed;\n\n    _.each(_ids, _id => {\n      if (!_id || _.contains(this.data, _id))\n        return;\n\n      this.data.push(_id);\n      changed = true;\n    });\n\n    if (this.sent && changed)\n      return this._cursor();\n  }\n  send () {\n    this.sent = true;\n    if (!this.data.length) return;\n\n    return this._cursor();\n  }\n  _selector () {\n    let _id = {$in: this.data};\n    return _.isFunction(this.selector) ? this.selector(_id): {_id: _id};\n  }\n  _cursor () {\n    return this.methods.cursor(this.collection.find(this._selector(), this.options), this.name);\n  }\n};","import CursorMethods from './cursor';\n\nCursorMethods.prototype.observe = function (cursor, callbacks) {\n  this.handler.add(cursor, {\n    handler: 'observe',\n    callbacks: callbacks\n  });\n};\n\nCursorMethods.prototype.observeChanges = function (cursor, callbacks) {\n  this.handler.add(cursor, {\n    handler: 'observeChanges',\n    callbacks: callbacks\n  });\n};","import { _ } from 'meteor/underscore';\nimport CursorMethods from './cursor';\n\nfunction getCB (cb, method) {\n  var callback = cb[method];\n  if (callback && !_.isFunction(callback))\n    throw new Error(method + ' should be a function or undefined');\n\n  return callback || function () {};\n};\n\nCursorMethods.prototype._getCallbacks = function (cb, onRemoved) {\n  if (_.isFunction(cb)) {\n    return {\n      added: cb,\n      changed: cb,\n      removed: getCB({onRemoved: onRemoved}, 'onRemoved')\n    };\n  }\n\n  return {\n    added: getCB(cb, 'added'),\n    changed: getCB(cb, 'changed'),\n    removed: getCB(cb, 'removed')\n  };\n};","import { _ } from 'meteor/underscore';\n\nexport default class CursorMethodsNR {\n  constructor (sub) {\n    this.sub = sub;\n  }\n  cursorNonreactive (cursor, collection, onAdded) {\n    const sub = this.sub;\n\n    if (!_.isString(collection)) {\n      onAdded = collection;\n      collection = cursor._getCollectionName();\n    }\n    if (!_.isFunction(onAdded))\n      onAdded = function () {};\n\n    cursor.forEach((doc) => {\n      let _id = doc._id;\n      sub.added(collection, _id, onAdded.call(new CursorMethodsNR(sub), _id, doc) || doc);\n    });\n  }\n};","import CursorMethodsNR from './cursor';\nimport './join';\n\nexport default CursorMethodsNR;","import { _ } from 'meteor/underscore';\nimport CursorMethodsNR from './cursor';\n\nCursorMethodsNR.prototype.joinNonreactive = function (...params) {\n  return new CursorJoinNonreactive(this.sub, ...params);\n};\n\nclass CursorJoinNonreactive {\n  constructor (sub, collection, options, name) {\n    this.sub = sub;\n    this.collection = collection;\n    this.options = options;\n    this.name = name || collection._name;\n\n    this.data = [];\n    this.sent = false;\n  }\n  _selector (_id = {$in: this.data}) {\n    return _.isFunction(this.selector) ? this.selector(_id): {_id: _id};\n  }\n  push (..._ids) {\n    let newIds = [];\n\n    _.each(_ids, _id => {\n      if (!_id || _.contains(this.data, _id))\n        return;\n\n      this.data.push(_id);\n      newIds.push(_id);\n    });\n\n    if (this.sent && newIds.length)\n      return this.added(newIds.length > 1 ? {$in: newIds}: newIds[0]);\n  }\n  send () {\n    this.sent = true;\n    if (!this.data.length) return;\n\n    return this.added();\n  }\n  added (_id) {\n    this.collection.find(this._selector(_id), this.options).forEach(doc => {\n      this.sub.added(this.name, doc._id, _.omit(doc, '_id'));\n    });\n  }\n};"]}